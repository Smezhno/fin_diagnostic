# –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ FinRentgen Wave 1

**Overview:** –ü–æ—ç—Ç–∞–ø–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è Ultra-MVP —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ —Å–æ–≥–ª–∞—Å–Ω–æ RFC. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø ‚Äî –ª–æ–≥–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–π –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ.

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
flowchart TB
    subgraph input [–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ]
        File[CSV/Excel —Ñ–∞–π–ª]
        Context[–ö–æ–Ω—Ç–µ–∫—Å—Ç –±–∏–∑–Ω–µ—Å–∞]
    end
    
    subgraph data_layer [–°–ª–æ–π –¥–∞–Ω–Ω—ã—Ö]
        Parser[parser.py]
        Cleaner[cleaner.py]
        Models[models.py]
    end
    
    subgraph core_layer [–Ø–¥—Ä–æ]
        Metrics[metrics.py]
        Analyzer[analyzer.py]
    end
    
    subgraph llm_layer [LLM —Å–ª–æ–π]
        Prompts[prompts.py]
        Client[client.py]
        ResponseParser[response_parser.py]
    end
    
    subgraph ui_layer [UI —Å–ª–æ–π]
        Styles[styles.py]
        Components[components.py]
        App[app.py]
    end
    
    File --> Parser
    Parser --> Cleaner
    Cleaner --> Models
    Models --> Metrics
    Metrics --> Analyzer
    Context --> Analyzer
    Analyzer --> Prompts
    Prompts --> Client
    Client --> ResponseParser
    ResponseParser --> Components
    Styles --> Components
    Components --> App
```

---

## –≠—Ç–∞–ø—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç (config + models)

–ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–≤–∏—Å—è—Ç –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ.

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `config.py` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ pydantic-settings |
| `.env.example` | –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è |
| `data/__init__.py` | –≠–∫—Å–ø–æ—Ä—Ç –º–æ–¥–µ–ª–µ–π |
| `data/models.py` | Pydantic-–º–æ–¥–µ–ª–∏: PnLRow, PnLData, CalculatedMetrics, Insight, AnalysisResult |

**–ü—Ä–æ–≤–µ—Ä–∫–∞:** 
- –ò–º–ø–æ—Ä—Ç `from data.models import PnLRow` –±–µ–∑ –æ—à–∏–±–æ–∫
- –í–∞–ª–∏–¥–∞—Ü–∏—è: `PnLRow(period=date(2024,1,1), revenue=100000)` —Å–æ–∑–¥–∞—ë—Ç—Å—è —É—Å–ø–µ—à–Ω–æ
- –í–∞–ª–∏–¥–∞—Ü–∏—è: `PnLRow(period=date(2024,1,1), revenue=-100)` –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç ValidationError

- [x] config.py
- [x] .env.example
- [x] data/__init__.py
- [x] data/models.py

---

### –≠—Ç–∞–ø 2: –ü–∞—Ä—Å–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö (parser + cleaner)

–ß—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∏ –æ—á–∏—Å—Ç–∫–∞ –≥—Ä—è–∑–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `data/parser.py` | –ß—Ç–µ–Ω–∏–µ CSV/Excel, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞, –ø–µ—Ä–≤—ã–π –ª–∏—Å—Ç –¥–ª—è Excel |
| `data/cleaner.py` | –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ–ª–æ–Ω–æ–∫, –æ—á–∏—Å—Ç–∫–∞ —á–∏—Å–µ–ª ("1 200 000" -> 1200000), –ø–∞—Ä—Å–∏–Ω–≥ –¥–∞—Ç |
| `examples/sample_pnl_clean.csv` | –ß–∏—Å—Ç—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (6 –ø–µ—Ä–∏–æ–¥–æ–≤) |
| `examples/sample_pnl_dirty.csv` | –ì—Ä—è–∑–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø—Ä–æ–±–µ–ª—ã, "‚Äî", "–Ω–µ—Ç", —Å—Ç—Ä–æ–∫–∞ "–ò—Ç–æ–≥–æ") |

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ sample_pnl_clean.csv:**
- –ü–∞—Ä—Å–∏—Ç—Å—è –±–µ–∑ warnings
- 6 —Å—Ç—Ä–æ–∫ –¥–∞–Ω–Ω—ã—Ö
- revenue –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ = 850000

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ sample_pnl_dirty.csv:**
- –ü–∞—Ä—Å–∏—Ç—Å—è —Å warnings: "–£–¥–∞–ª–µ–Ω–æ X —Å—Ç—Ä–æ–∫ –±–µ–∑ –≤—ã—Ä—É—á–∫–∏", "–ù–µ—Ä–∞—Å–ø–æ–∑–Ω–∞–Ω–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏"
- –°—Ç—Ä–æ–∫–∞ "–ò—Ç–æ–≥–æ" —É–¥–∞–ª–µ–Ω–∞
- "1 200 000" –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–æ –≤ 1200000.0
- "‚Äî" –∏ "–Ω–µ—Ç" –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω—ã –≤ None

- [x] data/parser.py
- [x] data/cleaner.py
- [x] examples/sample_pnl_clean.csv (—É–∂–µ –µ—Å—Ç—å)
- [x] examples/sample_pnl_dirty.csv (—É–∂–µ –µ—Å—Ç—å)

---

### –≠—Ç–∞–ø 3: –†–∞—Å—á—ë—Ç –º–µ—Ç—Ä–∏–∫ (metrics)

–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–∞—Å—á—ë—Ç –≤—Å–µ—Ö —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π.

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `core/__init__.py` | –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π |
| `core/metrics.py` | –°—Ä–µ–¥–Ω–∏–µ, —Ç—Ä–µ–Ω–¥—ã, –¥–æ–ª–∏ —Ä–∞—Å—Ö–æ–¥–æ–≤, –¥–µ—Ç–µ–∫—Ü–∏—è –∞–Ω–æ–º–∞–ª–∏–π |

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ sample_pnl_clean.csv:**
- `avg_revenue` = 876667 (–æ–∫—Ä—É–≥–ª–µ–Ω–æ)
- `avg_operating_margin_pct` ‚âà 12.5%
- `revenue_trend_direction` = "growing" (+6.3%, —Ç.–∫. 6 –ø–µ—Ä–∏–æ–¥–æ–≤ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è —Ç—Ä–µ–Ω–¥–∞)
- `anomalies` = [] (–Ω–µ—Ç —Å–∫–∞—á–∫–æ–≤ >30% –≤ –¥–∞–Ω–Ω—ã—Ö)

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ sample_pnl_dirty.csv:**
- –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏: 5 –≤–∞–ª–∏–¥–Ω—ã—Ö –ø–µ—Ä–∏–æ–¥–æ–≤
- `revenue_trend_direction` = "insufficient_data"

- [x] core/__init__.py
- [x] core/metrics.py

---

### –≠—Ç–∞–ø 4: LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (prompts + client + response_parser)

AI-–∞–≥–Ω–æ—Å—Ç–∏—á–Ω—ã–π —Å–ª–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å LLM.

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `llm/__init__.py` | –§–∞–±—Ä–∏–∫–∞ `get_llm_client()` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞ |
| `llm/prompts.py` | SYSTEM_PROMPT –∏ ANALYSIS_PROMPT |
| `llm/client.py` | Protocol `LLMClient` + –∫–ª–∞—Å—Å `OpenAIClient` —Å retry |
| `llm/response_parser.py` | –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON, repair, –ø–∞—Ä—Å–∏–Ω–≥ –∏–Ω—Å–∞–π—Ç–æ–≤ |

**AI-–∞–≥–Ω–æ—Å—Ç–∏—á–Ω–æ—Å—Ç—å:** 
- `LLMClient` ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π Protocol —Å –º–µ—Ç–æ–¥–æ–º `complete()`
- `OpenAIClient` ‚Äî –ø–µ—Ä–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- `get_llm_client()` ‚Äî —Ñ–∞–±—Ä–∏–∫–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º
- –í Wave 2: –¥–æ–±–∞–≤–∏—Ç—å `YandexGPTClient`, `GigaChatClient` –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `from llm import get_llm_client` —Ä–∞–±–æ—Ç–∞–µ—Ç
- JSON repair: `'{"a": 1,}'` ‚Üí `{"a": 1}`
- JSON repair: ``` ```json\n{"a":1}\n``` ``` ‚Üí `{"a": 1}`
- `parse_insights()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ `Insight` –∏–∑ –≤–∞–ª–∏–¥–Ω–æ–≥–æ JSON

- [ ] llm/__init__.py
- [ ] llm/prompts.py
- [ ] llm/client.py
- [ ] llm/response_parser.py

---

### –≠—Ç–∞–ø 5: –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è (analyzer)

–°–≤—è–∑—ã–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –µ–¥–∏–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω.

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `core/analyzer.py` | `analyze_file()`: –ø–∞—Ä—Å–∏–Ω–≥ ‚Üí –æ—á–∏—Å—Ç–∫–∞ ‚Üí –º–µ—Ç—Ä–∏–∫–∏ ‚Üí LLM ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç |

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `analyze_file("examples/sample_pnl_clean.csv")` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `AnalysisResult`
- `result.metrics.avg_revenue` = 876667
- `result.insights` —Å–æ–¥–µ—Ä–∂–∏—Ç 3-5 —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Ç–∏–ø–∞ `Insight`
- `result.parsing_warnings` ‚Äî —Å–ø–∏—Å–æ–∫ (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç–æ–π –¥–ª—è clean.csv)

- [ ] core/analyzer.py

---

### –≠—Ç–∞–ø 6: UI (styles ‚Üí components ‚Üí app)

Gradio-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ —Å—Ç–∏–ª—è–º–∏.

**–ü–æ—Ä—è–¥–æ–∫ –≤–∞–∂–µ–Ω:** styles.py ‚Üí components.py ‚Üí app.py (–∫–∞–∂–¥—ã–π —Å–ª–µ–¥—É—é—â–∏–π –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏–π)

| –§–∞–π–ª | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| `ui/__init__.py` | –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ |
| `ui/styles.py` | CSS: —Ü–≤–µ—Ç–∞, –∫–∞—Ä—Ç–æ—á–∫–∏ –∏–Ω—Å–∞–π—Ç–æ–≤ (üî¥üü°üü¢) |
| `ui/components.py` | Gradio Blocks: –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞, –º–µ—Ç—Ä–∏–∫–∏, –∏–Ω—Å–∞–π—Ç—ã |
| `app.py` | –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∑–∞–ø—É—Å–∫ –Ω–∞ –ø–æ—Ä—Ç—É 7860 |

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
- `python app.py` –∑–∞–ø—É—Å–∫–∞–µ—Ç —Å–µ—Ä–≤–µ—Ä –Ω–∞ http://localhost:7860
- –ó–∞–≥—Ä—É–∑–∫–∞ sample_pnl_clean.csv –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –∏–Ω—Å–∞–π—Ç—ã
- –ó–∞–≥—Ä—É–∑–∫–∞ sample_pnl_dirty.csv –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç warnings "–ú—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ –¥–∞–Ω–Ω—ã–µ"
- –ò–Ω—Å–∞–π—Ç—ã –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π (problem=üî¥, observation=üü°, opportunity=üü¢)

- [ ] ui/__init__.py
- [ ] ui/styles.py (–ø–µ—Ä–≤—ã–π!)
- [ ] ui/components.py (–≤—Ç–æ—Ä–æ–π)
- [ ] app.py (—Ç—Ä–µ—Ç–∏–π)

---

### –≠—Ç–∞–ø 7: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è

| –§–∞–π–ª/–ó–∞–¥–∞—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------------|----------|
| `requirements.txt` | –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/–¥–æ–ø–æ–ª–Ω–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ |
| –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ | –î–æ–±–∞–≤–∏—Ç—å `logging` –≤–æ –≤—Å–µ –º–æ–¥—É–ª–∏ (–æ—Å–æ–±–µ–Ω–Ω–æ LLM –∑–∞–ø—Ä–æ—Å—ã/–æ—Ç–≤–µ—Ç—ã) |
| `README.md` | –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ |

**–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è:**
- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ LLM –≤ –∫–æ–Ω—Å–æ–ª—å –≤—ã–≤–æ–¥–∏—Ç—Å—è: –ø—Ä–æ–º–ø—Ç (—É–∫–æ—Ä–æ—á–µ–Ω–Ω—ã–π), –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞, —Ä–∞–∑–º–µ—Ä –æ—Ç–≤–µ—Ç–∞
- –ü—Ä–∏ –æ—à–∏–±–∫–µ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON ‚Äî –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç LLM –≤ –ª–æ–≥–∞—Ö

**–ü—Ä–æ–≤–µ—Ä–∫–∞ README:**
- –°–æ–¥–µ—Ä–∂–∏—Ç: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, —Å–æ–∑–¥–∞–Ω–∏–µ .env, –∑–∞–ø—É—Å–∫, –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

- [ ] requirements.txt (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å)
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] README.md
- [ ] –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —ç—Ç–∞–ø–æ–≤

```
–≠—Ç–∞–ø 1 ‚îÄ‚î¨‚îÄ> –≠—Ç–∞–ø 2 ‚îÄ‚îÄ> –≠—Ç–∞–ø 3 ‚îÄ‚î¨‚îÄ> –≠—Ç–∞–ø 5 ‚îÄ‚îÄ> –≠—Ç–∞–ø 6 ‚îÄ‚îÄ> –≠—Ç–∞–ø 7
        ‚îÇ                      ‚îÇ
        ‚îî‚îÄ> –≠—Ç–∞–ø 4 ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –∫–æ–º–º–∏—Ç–æ–º –≤ git.

---

## –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

| –≠—Ç–∞–ø | –°—Ç–∞—Ç—É—Å |
|------|--------|
| 1. –§—É–Ω–¥–∞–º–µ–Ω—Ç | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 2. –ü–∞—Ä—Å–∏–Ω–≥ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 3. –ú–µ—Ç—Ä–∏–∫–∏ | ‚úÖ –ì–æ—Ç–æ–≤–æ |
| 4. LLM | ‚è≥ –û–∂–∏–¥–∞–µ—Ç |
| 5. –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è | ‚è≥ –û–∂–∏–¥–∞–µ—Ç |
| 6. UI | ‚è≥ –û–∂–∏–¥–∞–µ—Ç |
| 7. –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è | ‚è≥ –û–∂–∏–¥–∞–µ—Ç |

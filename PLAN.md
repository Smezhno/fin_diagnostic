# ะะปะฐะฝ ัะตะฐะปะธะทะฐัะธะธ FinRentgen Wave 1

**Overview:** ะะพััะฐะฟะฝะฐั ัะตะฐะปะธะทะฐัะธั Ultra-MVP ัะธะฝะฐะฝัะพะฒะพะณะพ ะฐะฝะฐะปะธะทะฐัะพัะฐ ัะพะณะปะฐัะฝะพ RFC. ะะฐะถะดัะน ััะฐะฟ โ ะปะพะณะธัะตัะบะธ ะทะฐะฒะตัััะฝะฝัะน ะฑะปะพะบ, ะบะพัะพััะน ะผะพะถะฝะพ ะฟัะพัะตััะธัะพะฒะฐัั ะพัะดะตะปัะฝะพ.

---

## ะััะธัะตะบัััะฐ

```mermaid
flowchart TB
    subgraph input [ะัะพะดะฝัะต ะดะฐะฝะฝัะต]
        File[CSV/Excel ัะฐะนะป]
        Context[ะะพะฝัะตะบัั ะฑะธะทะฝะตัะฐ]
    end
    
    subgraph data_layer [ะกะปะพะน ะดะฐะฝะฝัั]
        Parser[parser.py]
        Cleaner[cleaner.py]
        Models[models.py]
    end
    
    subgraph core_layer [ะฏะดัะพ]
        Metrics[metrics.py]
        Analyzer[analyzer.py]
    end
    
    subgraph llm_layer [LLM ัะปะพะน]
        Prompts[prompts.py]
        Client[client.py]
        ResponseParser[response_parser.py]
    end
    
    subgraph ui_layer [UI ัะปะพะน]
        Styles[styles.py]
        Components[components.py]
        App[app.py]
    end
    
    File --> Parser
    Parser --> Cleaner
    Cleaner --> Models
    Models --> Metrics
    Metrics --> Analyzer
    Context --> Analyzer
    Analyzer --> Prompts
    Prompts --> Client
    Client --> ResponseParser
    ResponseParser --> Components
    Styles --> Components
    Components --> App
```

---

## ะญัะฐะฟั ัะตะฐะปะธะทะฐัะธะธ

### ะญัะฐะฟ 1: ะคัะฝะดะฐะผะตะฝั (config + models)

ะะฐะทะพะฒัะต ะผะพะดัะปะธ, ะพั ะบะพัะพััั ะทะฐะฒะธััั ะฒัะต ะพััะฐะปัะฝัะต.

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `config.py` | ะะพะฝัะธะณััะฐัะธั ัะตัะตะท pydantic-settings |
| `.env.example` | ะจะฐะฑะปะพะฝ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั |
| `data/__init__.py` | ะญะบัะฟะพัั ะผะพะดะตะปะตะน |
| `data/models.py` | Pydantic-ะผะพะดะตะปะธ: PnLRow, PnLData, CalculatedMetrics, Insight, AnalysisResult |

**ะัะพะฒะตัะบะฐ:** 
- ะะผะฟะพัั `from data.models import PnLRow` ะฑะตะท ะพัะธะฑะพะบ
- ะะฐะปะธะดะฐัะธั: `PnLRow(period=date(2024,1,1), revenue=100000)` ัะพะทะดะฐัััั ััะฟะตัะฝะพ
- ะะฐะปะธะดะฐัะธั: `PnLRow(period=date(2024,1,1), revenue=-100)` ะฒัะฑัะฐััะฒะฐะตั ValidationError

- [x] config.py
- [x] .env.example
- [x] data/__init__.py
- [x] data/models.py

---

### ะญัะฐะฟ 2: ะะฐััะธะฝะณ ะดะฐะฝะฝัั (parser + cleaner)

ะงัะตะฝะธะต ัะฐะนะปะพะฒ ะธ ะพัะธััะบะฐ ะณััะทะฝัั ะดะฐะฝะฝัั.

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `data/parser.py` | ะงัะตะฝะธะต CSV/Excel, ะพะฟัะตะดะตะปะตะฝะธะต ัะพัะผะฐัะฐ, ะฟะตัะฒัะน ะปะธัั ะดะปั Excel |
| `data/cleaner.py` | ะะพัะผะฐะปะธะทะฐัะธั ะบะพะปะพะฝะพะบ, ะพัะธััะบะฐ ัะธัะตะป ("1 200 000" -> 1200000), ะฟะฐััะธะฝะณ ะดะฐั |
| `examples/sample_pnl_clean.csv` | ะงะธัััะต ัะตััะพะฒัะต ะดะฐะฝะฝัะต (6 ะฟะตัะธะพะดะพะฒ) |
| `examples/sample_pnl_dirty.csv` | ะััะทะฝัะต ัะตััะพะฒัะต ะดะฐะฝะฝัะต (ะฟัะพะฑะตะปั, "โ", "ะฝะตั", ัััะพะบะฐ "ะัะพะณะพ") |

**ะัะพะฒะตัะบะฐ ะฝะฐ sample_pnl_clean.csv:**
- ะะฐััะธััั ะฑะตะท warnings
- 6 ัััะพะบ ะดะฐะฝะฝัั
- revenue ะฟะตัะฒะพะน ัััะพะบะธ = 850000

**ะัะพะฒะตัะบะฐ ะฝะฐ sample_pnl_dirty.csv:**
- ะะฐััะธััั ั warnings: "ะฃะดะฐะปะตะฝะพ X ัััะพะบ ะฑะตะท ะฒััััะบะธ", "ะะตัะฐัะฟะพะทะฝะฐะฝะฝัะต ะบะพะปะพะฝะบะธ"
- ะกััะพะบะฐ "ะัะพะณะพ" ัะดะฐะปะตะฝะฐ
- "1 200 000" ะฟัะตะพะฑัะฐะทะพะฒะฐะฝะพ ะฒ 1200000.0
- "โ" ะธ "ะฝะตั" ะฟัะตะพะฑัะฐะทะพะฒะฐะฝั ะฒ None

- [x] data/parser.py
- [x] data/cleaner.py
- [x] examples/sample_pnl_clean.csv (ัะถะต ะตััั)
- [x] examples/sample_pnl_dirty.csv (ัะถะต ะตััั)

---

### ะญัะฐะฟ 3: ะะฐัััั ะผะตััะธะบ (metrics)

ะะพะบะฐะปัะฝัะน ัะฐัััั ะฒัะตั ัะธะฝะฐะฝัะพะฒัั ะฟะพะบะฐะทะฐัะตะปะตะน.

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `core/__init__.py` | ะญะบัะฟะพัั ััะฝะบัะธะน |
| `core/metrics.py` | ะกัะตะดะฝะธะต, ััะตะฝะดั, ะดะพะปะธ ัะฐััะพะดะพะฒ, ะดะตัะตะบัะธั ะฐะฝะพะผะฐะปะธะน |

**ะัะพะฒะตัะบะฐ ะฝะฐ sample_pnl_clean.csv:**
- `avg_revenue` = 876667 (ะพะบััะณะปะตะฝะพ)
- `avg_operating_margin_pct` โ 12.5%
- `revenue_trend_direction` = "growing" (+6.3%, ั.ะบ. 6 ะฟะตัะธะพะดะพะฒ ะดะพััะฐัะพัะฝะพ ะดะปั ััะตะฝะดะฐ)
- `anomalies` = [] (ะฝะตั ัะบะฐัะบะพะฒ >30% ะฒ ะดะฐะฝะฝัั)

**ะัะพะฒะตัะบะฐ ะฝะฐ sample_pnl_dirty.csv:**
- ะะพัะปะต ะพัะธััะบะธ: 5 ะฒะฐะปะธะดะฝัั ะฟะตัะธะพะดะพะฒ
- `revenue_trend_direction` = "insufficient_data"

- [x] core/__init__.py
- [x] core/metrics.py

---

### ะญัะฐะฟ 4: LLM ะธะฝัะตะณัะฐัะธั (prompts + client + response_parser)

AI-ะฐะณะฝะพััะธัะฝัะน ัะปะพะน ะดะปั ัะฐะฑะพัั ั LLM.

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `llm/__init__.py` | ะคะฐะฑัะธะบะฐ `get_llm_client()` ะดะปั ะฟะพะปััะตะฝะธั ะบะปะธะตะฝัะฐ |
| `llm/prompts.py` | SYSTEM_PROMPT ะธ ANALYSIS_PROMPT |
| `llm/client.py` | Protocol `LLMClient` + ะบะปะฐัั `OpenAIClient` ั retry |
| `llm/response_parser.py` | ะะทะฒะปะตัะตะฝะธะต JSON, repair, ะฟะฐััะธะฝะณ ะธะฝัะฐะนัะพะฒ |

**AI-ะฐะณะฝะพััะธัะฝะพััั:** 
- `LLMClient` โ ะฐะฑัััะฐะบัะฝัะน Protocol ั ะผะตัะพะดะพะผ `complete()`
- `OpenAIClient` โ ะฟะตัะฒะฐั ัะตะฐะปะธะทะฐัะธั
- `get_llm_client()` โ ัะฐะฑัะธะบะฐ, ะฒะพะทะฒัะฐัะฐะตั ะบะปะธะตะฝั ะฟะพ ะฝะฐัััะพะนะบะฐะผ
- ะ Wave 2: ะดะพะฑะฐะฒะธัั `YandexGPTClient`, `GigaChatClient` ะฑะตะท ะธะทะผะตะฝะตะฝะธั ะพััะฐะปัะฝะพะณะพ ะบะพะดะฐ

**ะัะพะฒะตัะบะฐ:**
- `from llm import get_llm_client` ัะฐะฑะพัะฐะตั
- JSON repair: `'{"a": 1,}'` โ `{"a": 1}`
- JSON repair: ``` ```json\n{"a":1}\n``` ``` โ `{"a": 1}`
- `parse_insights()` ะฒะพะทะฒัะฐัะฐะตั ัะฟะธัะพะบ `Insight` ะธะท ะฒะฐะปะธะดะฝะพะณะพ JSON

- [x] llm/__init__.py
- [x] llm/prompts.py
- [x] llm/client.py
- [x] llm/response_parser.py

---

### ะญัะฐะฟ 5: ะัะบะตัััะฐัะธั (analyzer)

ะกะฒัะทัะฒะฐะฝะธะต ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ ะฒ ะตะดะธะฝัะน ะฟะฐะนะฟะปะฐะนะฝ.

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `core/analyzer.py` | `analyze_file()`: ะฟะฐััะธะฝะณ โ ะพัะธััะบะฐ โ ะผะตััะธะบะธ โ LLM โ ัะตะทัะปััะฐั |

**ะัะพะฒะตัะบะฐ:**
- `analyze_file("examples/sample_pnl_clean.csv")` ะฒะพะทะฒัะฐัะฐะตั `AnalysisResult`
- `result.metrics.avg_revenue` = 876667
- `result.insights` ัะพะดะตัะถะธั 3-5 ัะปะตะผะตะฝัะพะฒ ัะธะฟะฐ `Insight`
- `result.parsing_warnings` โ ัะฟะธัะพะบ (ะผะพะถะตั ะฑััั ะฟัััะพะน ะดะปั clean.csv)

- [x] core/analyzer.py

---

### ะญัะฐะฟ 6: UI (styles โ components โ app)

Gradio-ะธะฝัะตััะตะนั ั ะบะฐััะพะผะฝัะผะธ ััะธะปัะผะธ.

**ะะพััะดะพะบ ะฒะฐะถะตะฝ:** styles.py โ components.py โ app.py (ะบะฐะถะดัะน ัะปะตะดัััะธะน ะธะผะฟะพััะธััะตั ะฟัะตะดัะดััะธะน)

| ะคะฐะนะป | ะะฟะธัะฐะฝะธะต |
|------|----------|
| `ui/__init__.py` | ะญะบัะฟะพัั ะบะพะผะฟะพะฝะตะฝัะพะฒ |
| `ui/styles.py` | CSS: ัะฒะตัะฐ, ะบะฐััะพัะบะธ ะธะฝัะฐะนัะพะฒ (๐ด๐ก๐ข) |
| `ui/components.py` | Gradio Blocks: ะทะฐะณััะทะบะฐ ัะฐะนะปะฐ, ะผะตััะธะบะธ, ะธะฝัะฐะนัั |
| `app.py` | ะขะพัะบะฐ ะฒัะพะดะฐ, ะทะฐะฟััะบ ะฝะฐ ะฟะพััั 7860 |

**ะัะพะฒะตัะบะฐ:**
- `python app.py` ะทะฐะฟััะบะฐะตั ัะตัะฒะตั ะฝะฐ http://localhost:7860
- ะะฐะณััะทะบะฐ sample_pnl_clean.csv ะฟะพะบะฐะทัะฒะฐะตั ะผะตััะธะบะธ ะธ ะธะฝัะฐะนัั
- ะะฐะณััะทะบะฐ sample_pnl_dirty.csv ะฟะพะบะฐะทัะฒะฐะตั warnings "ะั ะธัะฟัะฐะฒะธะปะธ ะดะฐะฝะฝัะต"
- ะะฝัะฐะนัั ะพัะพะฑัะฐะถะฐัััั ั ัะฒะตัะพะฒะพะน ะบะพะดะธัะพะฒะบะพะน (problem=๐ด, observation=๐ก, opportunity=๐ข)

- [x] ui/__init__.py
- [x] ui/styles.py (ะฟะตัะฒัะน!)
- [x] ui/components.py (ะฒัะพัะพะน)
- [x] app.py (ััะตัะธะน)

---

### ะญัะฐะฟ 7: ะคะธะฝะฐะปะธะทะฐัะธั

| ะคะฐะนะป/ะะฐะดะฐัะฐ | ะะฟะธัะฐะฝะธะต |
|-------------|----------|
| `requirements.txt` | ะัะพะฒะตัะธัั/ะดะพะฟะพะปะฝะธัั ะทะฐะฒะธัะธะผะพััะธ |
| ะะพะณะธัะพะฒะฐะฝะธะต | ะะพะฑะฐะฒะธัั `logging` ะฒะพ ะฒัะต ะผะพะดัะปะธ (ะพัะพะฑะตะฝะฝะพ LLM ะทะฐะฟัะพัั/ะพัะฒะตัั) |
| `README.md` | ะะฝััััะบัะธั ะฟะพ ะทะฐะฟััะบั |
| ะขะตััะธัะพะฒะฐะฝะธะต | ะััะฝะฐั ะฟัะพะฒะตัะบะฐ ะฟะพะปะฝะพะณะพ ัะธะบะปะฐ |

**ะัะพะฒะตัะบะฐ ะปะพะณะธัะพะฒะฐะฝะธั:**
- ะัะธ ะทะฐะฟัะพัะต ะบ LLM ะฒ ะบะพะฝัะพะปั ะฒัะฒะพะดะธััั: ะฟัะพะผะฟั (ัะบะพัะพัะตะฝะฝัะน), ะฒัะตะผั ะทะฐะฟัะพัะฐ, ัะฐะทะผะตั ะพัะฒะตัะฐ
- ะัะธ ะพัะธะฑะบะต ะฟะฐััะธะฝะณะฐ JSON โ ะฟะพะปะฝัะน ะพัะฒะตั LLM ะฒ ะปะพะณะฐั

**ะัะพะฒะตัะบะฐ README:**
- ะกะพะดะตัะถะธั: ัััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน, ัะพะทะดะฐะฝะธะต .env, ะทะฐะฟััะบ, ะฟัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

- [x] requirements.txt (ะฟัะพะฒะตัะตะฝ)
- [x] ะะพะณะธัะพะฒะฐะฝะธะต (ะฒ app.py)
- [x] README.md
- [ ] ะคะธะฝะฐะปัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต

---

## ะะฐะฒะธัะธะผะพััะธ ััะฐะฟะพะฒ

```
ะญัะฐะฟ 1 โโฌโ> ะญัะฐะฟ 2 โโ> ะญัะฐะฟ 3 โโฌโ> ะญัะฐะฟ 5 โโ> ะญัะฐะฟ 6 โโ> ะญัะฐะฟ 7
        โ                      โ
        โโ> ะญัะฐะฟ 4 โโโโโโโโโโโโโ
```

ะะฐะถะดัะน ััะฐะฟ ะทะฐะฒะตััะฐะตััั ะบะพะผะผะธัะพะผ ะฒ git.

---

## ะขะตะบััะธะน ััะฐััั

| ะญัะฐะฟ | ะกัะฐััั |
|------|--------|
| 1. ะคัะฝะดะฐะผะตะฝั | โ ะะพัะพะฒะพ |
| 2. ะะฐััะธะฝะณ | โ ะะพัะพะฒะพ |
| 3. ะะตััะธะบะธ | โ ะะพัะพะฒะพ |
| 4. LLM | โ ะะพัะพะฒะพ |
| 5. ะัะบะตัััะฐัะธั | โ ะะพัะพะฒะพ |
| 6. UI | โ ะะพัะพะฒะพ |
| 7. ะคะธะฝะฐะปะธะทะฐัะธั | ๐ ะ ะฟัะพัะตััะต |
